import{C as g,s as w}from"./ChatComponent-e89c5ab8.js";import{_ as f,k as h}from"./VAvatar-ee3fb148.js";import{V,a as N,c as y,e as x}from"./VCard-2d3a232c.js";import{V as d}from"./VRow-7ee72a6f.js";import{V as i}from"./VCol-1397f2ac.js";import{U as C,J as a,K as c,L as e,n as t,R as r,S as m,O as _,a6 as k,a7 as I,a8 as T}from"./index-e5ee06f2.js";import"./index-7f83b671.js";import"./VTextField-ec68c5e6.js";import"./index-df71d2ee.js";import"./VBtn-7f686220.js";const S={name:"WatchingVideo",components:{ChatComponent:g},data(){return{started:!1,viewers:0,time:0,streamName:null,peerConnection:null,config:{iceServers:[{urls:"stun:stun.l.google.com:19302"}]},socket:w,video:document.querySelector("video")}},computed:{roomName(){return this.$route.params.username},user(){return this.$store.state.auth.user}},mounted(){console.log("join room"),this.video=document.querySelector("video"),this.socket.emit("join room",{roomName:this.roomName,user:this.user}),this.socket.on("stream info",o=>{this.viewers=o.viewers,this.streamName=o.streamName}),this.started=!0,this.socket.on("end of stream",()=>{this.started=!1,this.$router.push("/")}),this.socket.on("offer",(o,l)=>{this.peerConnection=new RTCPeerConnection(this.config),this.peerConnection.setRemoteDescription(l).then(()=>this.peerConnection.createAnswer()).then(n=>this.peerConnection.setLocalDescription(n)).then(()=>{this.socket.emit("answer",o,this.peerConnection.localDescription)}),this.peerConnection.ontrack=n=>{this.started=!0,this.toggleTimer(),this.video.srcObject=n.streams[0]},this.peerConnection.onicecandidate=n=>{n.candidate&&this.socket.emit("icecandidate",o,n.candidate)}}),this.socket.on("icecandidate",(o,l)=>{this.peerConnection.addIceCandidate(new RTCIceCandidate(l)).catch(n=>console.error(n))}),window.onunload=window.onbeforeunload=()=>{this.socket.emit("left room",{roomName:this.roomName,user:this.user}),this.socket.close(),this.peerConnection.close()}},methods:{toggleTimer(){this.started?this.interval=setInterval(this.incrementTime,1e3):(clearInterval(this.interval),console.log("timer stops")),this.isRunning=!this.isRunning},incrementTime(){this.time=parseInt(this.time)+1}}},R=o=>(I("data-v-4417b850"),o=o(),T(),o),b=R(()=>k("video",{playsinline:"",autoplay:"",muted:"",id:"video"},null,-1)),W={class:"red--text"};function D(o,l,n,v,s,p){const u=C("chat-component");return a(),c(d,null,{default:e(()=>[t(i,{cols:"9"},{default:e(()=>[t(V,null,{default:e(()=>[t(N,null,{default:e(()=>[r(" Просмотр трансляции ")]),_:1}),t(y,null,{default:e(()=>[t(d,null,{default:e(()=>[t(i,null,{default:e(()=>[b]),_:1})]),_:1}),t(d,null,{default:e(()=>[t(i,{cols:"4"},{default:e(()=>[s.started?(a(),c(h,{key:0,color:"#F44336"},{default:e(()=>[r(" mdi-play ")]),_:1})):(a(),c(h,{key:1},{default:e(()=>[r(" mdi-play-pause ")]),_:1})),r(" "+m(s.streamName),1)]),_:1}),s.started?(a(),c(i,{key:0,cols:"4"},{default:e(()=>[r(" Длительность трансляции: "+m(("0"+(s.time/3600>>0)).slice(-2))+":"+m(("0"+(s.time/60>>0)).slice(-2))+":"+m(("0"+Number(((s.time/60-(s.time/60>>0))*60).toFixed(0))).slice(-2)),1)]),_:1})):_("",!0),s.started?_("",!0):(a(),c(i,{key:1,cols:"4"})),t(i,{cols:"4"},{default:e(()=>[t(h,{color:"#F44336"},{default:e(()=>[r("mdi-account-outline")]),_:1}),k("span",W,m(s.viewers),1)]),_:1})]),_:1})]),_:1}),t(x)]),_:1})]),_:1}),t(i,null,{default:e(()=>[t(u,{socket:s.socket,"room-name":p.roomName},null,8,["socket","room-name"])]),_:1})]),_:1})}const j=f(S,[["render",D],["__scopeId","data-v-4417b850"]]),B={name:"Watcher",components:{WatchingVideo:j}};function F(o,l,n,v,s,p){const u=C("watching-video");return a(),c(d,null,{default:e(()=>[t(i,null,{default:e(()=>[t(u)]),_:1})]),_:1})}const E=f(B,[["render",F]]);export{E as default};
